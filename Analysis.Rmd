---
title: "EEG analysis"
output: html_notebook
---

imports
```{r}
library(tidyr)
library(purrr)
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(reshape2)
```

load data
```{r}
inexp_meditation_files = sort(list.files("ffted/",pattern="^0_ffted_med"))
inexp_reference_files = sort(list.files("ffted/",pattern="^0_ffted_ref"))
exp_meditation_files = sort(list.files("ffted/",pattern="^1_ffted_med"))
exp_reference_files = sort(list.files("ffted/",pattern="^1_ffted_ref"))


exp_meditation = list()
for(i in 1:length(exp_meditation_files)) {
  file = exp_meditation_files[i]
  exp_meditation[[i]] <-  read.csv(paste("ffted/", file, sep=""))
}

inexp_meditation = list()
for(i in 1:length(inexp_meditation_files)) {
  file = inexp_meditation_files[i]
  inexp_meditation[[i]] <-  read.csv(paste("ffted/", file, sep=""))
}

exp_reference = list()
for(i in 1:length(exp_reference_files)) {
  file = exp_reference_files[i]
  exp_reference[[i]] <-  read.csv(paste("ffted/", file, sep=""))
}

inexp_reference = list()
for(i in 1:length(inexp_reference_files)) {
  file = inexp_reference_files[i]
  inexp_reference[[i]] <-  read.csv(paste("ffted/", file, sep=""))
}
```


subsetting data
```{r}
subset_and_melt <- function(med, exp, wave, electrodes, melt, melt_all){
  if(med){
    if(exp){
      df <- exp_meditation
    }
    else{
      df <- inexp_meditation
    }
  }
  else{
    if(exp){
      df <- exp_reference
    }
    else{
      df <- inexp_reference
    }
  }

  data = list()
  for(i in 1:length(df)) {
  data[[i]] <- df[[i]][, grepl(paste('(', wave, ')|(', electrodes, ')|(timestamp)', sep = ""), names(df[[i]]))]
  if(melt){
    #df <- melt(df, id.vars = 'time', variable.name = 'waves')
    data[[i]] <- melt(data[[i]], id.vars = 'timestamps', variable.name = 'waves')
  }
  }
  if(melt_all){
    data <- melt(data, id.vars = c('timestamps', 'waves', 'value'))
  }
  return(data)
}
```

testing
```{r}
temp_2 <- subset_and_melt(FALSE, TRUE, "beta", "None", TRUE, TRUE)
#ggplot(temp_2[[1]], aes(timestamps,value)) + geom_line(aes(colour = waves))
```

things to think about:
* extreme points, spikes, etc
* different smoothing rate
* difference between meditative and regular state
* difference between experienced meditators and newbies
* how to determine the levels and scale it for others
* what happens when meditation is stable
* explore the coherence between alpha and theta waves


explore experienced/inexperienced distributions of alpha wave
```{r}
alpha_exp_med = subset_and_melt(TRUE, TRUE, 'alpha', 'ALL', TRUE, TRUE)
alpha_inexp_med = subset_and_melt(TRUE, FALSE, 'alpha', 'ALL', TRUE, TRUE)
alpha_exp_med$exp <- "experienced"
alpha_exp_med$exp <- as.factor(alpha_exp_med$exp)
alpha_inexp_med$exp <- "inexperienced"
alpha_inexp_med$exp <- as.factor(alpha_inexp_med$exp)
temp <- rbind(alpha_exp_med, alpha_inexp_med)
ggplot(temp, aes(value, fill = exp)) + 
  geom_histogram(alpha = 0.5, bins = 100, position = 'identity')
```

explore experienced/inexperienced distributions of theta wave
```{r}
theta_exp_med = subset_and_melt(TRUE, TRUE, 'theta', 'ALL', TRUE, TRUE)
theta_inexp_med = subset_and_melt(TRUE, FALSE, 'theta', 'ALL', TRUE, TRUE)
theta_exp_med$exp <- "experienced"
theta_exp_med$exp <- as.factor(theta_exp_med$exp)
theta_inexp_med$exp <- "inexperienced"
theta_inexp_med$exp <- as.factor(theta_inexp_med$exp)
temp <- rbind(theta_exp_med, theta_inexp_med)
ggplot(temp, aes(value, fill = exp)) + 
  geom_histogram(alpha = 0.5, bins = 100, position = 'identity')
```

explore experienced/inexperienced distributions of beta wave
```{r}
beta_exp_med = subset_and_melt(TRUE, TRUE, 'beta', 'ALL', TRUE, TRUE)
beta_inexp_med = subset_and_melt(TRUE, FALSE, 'beta', 'ALL', TRUE, TRUE)
beta_exp_med$exp <- "experienced"
beta_exp_med$exp <- as.factor(beta_exp_med$exp)
beta_inexp_med$exp <- "inexperienced"
beta_inexp_med$exp <- as.factor(beta_inexp_med$exp)
temp <- rbind(beta_exp_med, beta_inexp_med)
ggplot(temp, aes(value, fill = exp)) + 
  geom_histogram(alpha = 0.5, bins = 100, position = 'identity')
```

explore experienced/inexperienced distributions of gamma wave
```{r}
gamma_exp_med = subset_and_melt(TRUE, TRUE, 'gamma', 'ALL', TRUE, TRUE)
gamma_inexp_med = subset_and_melt(TRUE, FALSE, 'gamma', 'ALL', TRUE, TRUE)
gamma_exp_med$exp <- "experienced"
gamma_exp_med$exp <- as.factor(gamma_exp_med$exp)
gamma_inexp_med$exp <- "inexperienced"
gamma_inexp_med$exp <- as.factor(gamma_inexp_med$exp)
temp <- rbind(gamma_exp_med, gamma_inexp_med)
ggplot(temp, aes(value, fill = exp)) + 
  geom_histogram(alpha = 0.5, bins = 100, position = 'identity')
```

explore experienced/inexperienced distributions of delta wave
```{r}
delta_exp_med = subset_and_melt(TRUE, TRUE, 'delta', 'ALL', TRUE, TRUE)
delta_inexp_med = subset_and_melt(TRUE, FALSE, 'delta', 'ALL', TRUE, TRUE)
delta_exp_med$exp <- "experienced"
delta_exp_med$exp <- as.factor(delta_exp_med$exp)
delta_inexp_med$exp <- "inexperienced"
delta_inexp_med$exp <- as.factor(delta_inexp_med$exp)
temp <- rbind(delta_exp_med, delta_inexp_med)
ggplot(temp, aes(value, fill = exp)) + 
  geom_histogram(alpha = 0.5, bins = 100, position = 'identity')
```

```{r}
alpha_exp_med<-alpha_exp_med[!(alpha_exp_med$value=="-Inf"),]
alpha_inexp_med<-alpha_inexp_med[!(alpha_inexp_med$value=="-Inf"),]
t.test(na.omit(alpha_exp_med$value), na.omit(alpha_inexp_med$value))
```

TODO:
remove -Inf
add functions for repeating code